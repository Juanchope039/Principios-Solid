variables:
- group: general-variable-Pipelines

stages:
  - stage: Build
    displayName: Build
    jobs:
      - job: Buid
        displayName: Build Test
        workspace:
          clean: all
        steps:
          - checkout: self
          - task: Bash@3
            inputs:
              targetType: 'inline'
              script: |
                echo Hello world
              workingDirectory: '$(Build.SourcesDirectory)'
            displayName: Hello world!

      - job: BuidTest
        displayName: Build Test
        workspace:
          clean: all
        steps:
          - checkout: self

          - task: Bash@3
            inputs:
              targetType: 'inline'
              script: |
                dir
                cd src
                dir
                cd com
                dir
                cd principios
                dir
                cd calculadora
              workingDirectory: '$(Build.SourcesDirectory)'
            displayName: Directory test

          - task: Bash@3
            inputs:
              targetType: 'inline'
              script: |
                echo Hello world
                dir
                java -version
                javac -version
                dir ./src/main/java/com/juanchope039/calculadora/
                java -cp ./src/main/java/ ./src/main/java/com/juanchope039/calculadora/App.java
              workingDirectory: '$(Build.SourcesDirectory)'
            displayName: Hello world!
#                javac ./src/main/java/com/juanchope039/calculadora/App.java

  - stage: Push
    displayName: Push
    dependsOn: Build 
    jobs:
      - job: CloneRepo
        displayName: Clone repo
        workspace:
          clean: all
        steps:
          - checkout: none
            clean: false
            persistCredentials: true

          - task: Bash@3
            inputs:
              targetType: 'inline'
              script: |
                git clone $(repoGitHub) $(Build.BinariesDirectory)
              workingDirectory: '$(Pipeline.Workspace)'
            displayName: 'Cloning GitHub Repo'

          - script: |
                git switch $(branchName)

                git remote add github $(remoteGitHub)
                git remote add azure $(repoAzure)
            workingDirectory: '$(Build.BinariesDirectory)'
            displayName: 'Configure remote Repo'

          - script: |
                git pull azure $(branchName)
            workingDirectory: '$(Build.BinariesDirectory)'
            displayName: 'Settings pull Repo'

          - task: Bash@3
            inputs:
              targetType: 'inline'
              script: |
                echo git config --global
                
                git config --global user.email "$(email)"
                git config --global user.name "$(name)"
                #!/bin/bash
                        set -x
                        git config --global credential.helper 'cache --timeout 600'
                        << eof tr -d ' ' | git credential-cache store
                          protocol=https
                          host=github.com
                          username=$(userNameGitHub)
                          password=${GITHUB_TOKEN}
                        eof
              bashEnvValue: 'GITHUB_TOKEN: $(gitHubPath)'
              workingDirectory: '$(Build.BinariesDirectory)'
            displayName: 'Cache GitHub credentials.'

          - script: |
                echo git push github $(branchName)
                git push github $(branchName)
            workingDirectory: '$(Build.BinariesDirectory)'
            displayName: 'Settings push Repo'